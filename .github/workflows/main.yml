name: Build C++ Launcher for Windows

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # 允许手动触发工作流
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup MSVC Developer Command Prompt
      uses: ilammy/msvc-dev-cmd@v1

    # --- 仅构建打包 INI 的版本 ---
    # 使用 shell: cmd 是为了正确处理 rc.exe 参数中的引号转义
    - name: Build Full Version (With Embedded INI)
      shell: cmd
      run: |
        echo Building Full Version...
        REM 编译资源文件 传入 INI 文件路径宏
        rc.exe /d "EMBED_INI_FILE=\"launcher.ini\"" /d "EMBED_HOOK_DLLS" /fo launcher.res launcher.rc

        REM 编译 C++ 代码并链接资源
        cl.exe /std:c++17 /EHsc /O2 /D "UNICODE" /D "_UNICODE" /utf-8 launcher.cpp launcher.res /Fe:yaP_Plus.exe /link Shlwapi.lib User32.lib ntdll.lib Shell32.lib Ole32.lib Advapi32.lib OleAut32.lib Userenv.lib

    # --- 上传 EXE 文件 ---
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: yaP_Plus
        path: yaP_Plus.exe
