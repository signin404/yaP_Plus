name: Build C++ Launcher for Windows

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # 允许手动触发工作流
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup MSVC Developer Command Prompt
      uses: ilammy/msvc-dev-cmd@v1

    # --- 构建不打包 INI 的版本 ---
    - name: Build Standard Version (No INI)
      run: |
        echo "Building Standard Version..."
        rc.exe launcher.rc
        cl.exe /std:c++17 /EHsc /O2 /D "UNICODE" /D "_UNICODE" /utf-8 launcher.cpp launcher.res /Fe:launcher.exe /link Shlwapi.lib User32.lib ntdll.lib Shell32.lib Ole32.lib Advapi32.lib OleAut32.lib Userenv.lib

    # --- 构建打包 INI 的版本 ---
    - name: Build Full Version (With Embedded INI)
      run: |
        rc.exe /d "EMBED_INI_FILE=\"launcher.ini\"" /fo launcher_full.res launcher.rc
        cl.exe /std:c++17 /EHsc /O2 /D "UNICODE" /D "_UNICODE" /utf-8 launcher.cpp launcher_full.res /Fe:launcher_full.exe /link Shlwapi.lib User32.lib ntdll.lib Shell32.lib Ole32.lib Advapi32.lib OleAut32.lib Userenv.lib

    # --- 上传两个 EXE 文件 ---
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: launcher_Binaries
        path: |
          launcher.exe
          launcher_full.exe
